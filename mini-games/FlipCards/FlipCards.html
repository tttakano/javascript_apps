<!DOCTYPE html>
<html>
    <head>
        <style>
        td.card {
            width: 100px;
            height: 140px;
            border: 1px solid blue;
            border-radius: 10px;
            text-align: center;
            font-size: 36px;
            background-color: white;
            box-shadow: rgb(128, 128, 128) 5px 5px;
        }
        td.back {
            background-image: url("card.png");
            background-size: 100px 140px;
        }    
        </style>
        <script>
        "use strict";
        //配列シャップる
        Array.prototype.shuffle = function (){
            var i = this.length;
            while(i){
                var j = Math.floor(Math.random() * i);
                var tmp = this[--i];
                this[i] = this[j];
                this[j] = tmp;
            }
            return this;
        }
        

        var timer = NaN, score = 0, flipTimer, prevCard, startTime;
        
        //create 4 * 5 columns and make new date , interval
        function init(){

            var cards = [];
            for (var i=1; i<=10; i++){
                cards.push(i);
                cards.push(i);
            }
            //cards.shuffle();

            var table = document.getElementById("table");
            for (var i=0;i<4; i++){
                var tr = document.createElement("tr");
                for (var j=0; j<5; j++){
                    var td = document.createElement("td");
                    td.className = "card back";
                    td.number = cards[i * 5 + j];
                    td.onclick = flip;
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            startTime = new Date();
            timer = setInterval(tick, 1000);
        }

        //経過時間用timer
        function tick(){
            var now = new Date();
            var elapse = Math.floor((now.getTime()-startTime.getTime()) / 1000);
            document.getElementById("time").textContent = elapse;
        }
        //カード裏返し
        function flip(e){
            var src = e.target;
            var num = src.number;
            if(flipTimer || src.textContent != ""){
                return;
            }
            src.className = "card";
            src.textContent = num;
            
            if(prevCard == null){
                prevCard = src;
                return;
            }
            if(prevCard.number == num){
                if(++score == 10){
                    console.log("clear");
                    clearInterval(timer);
                }
                clearTimeout(flipTimer);
                prevCard = null;
            }else{
                flipTimer = setTimeout(function(){
                    src.className = "card back";
                    src.textContent = "";
                    prevCard.className = "card back";
                    prevCard.textContent = "";
                    prevCard = null;
                    flipTimer = NaN;
                },1000);
            }

            
        }
        </script>
    
    </head>
    <body onload="init()">
        <table id="table"></table>
        <h2>
            経過時間 <span id="time">0</span> 秒
        </h2>

    </body>
</html>